<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Making of Tiger #3, Parsing · vyorkin.org
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Vasiliy Yorkin">
<meta name="description" content="Intro Link to heading In this chapter we’re going to build a parser for our Tiger language. First, let’s do a quick recap of some important concepts of the theory behind programming language parsers:
Parser generator is the most common type of compiler-compiler’s. It takes some formal grammar (typically it is a context-free grammar in BNF or EBNF form), that defines a syntax of a programming language. Tiger grammar with Menhir Link to heading While reading the current paragraph I highly recommend consulting the Tiger Language Reference Manual that has a precise description (along with a BNF notation) of everything we’re going to define below.">
<meta name="keywords" content="Vasiliy Yorkin">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Making of Tiger #3, Parsing">
  <meta name="twitter:description" content="Intro Link to heading In this chapter we’re going to build a parser for our Tiger language. First, let’s do a quick recap of some important concepts of the theory behind programming language parsers:
Parser generator is the most common type of compiler-compiler’s. It takes some formal grammar (typically it is a context-free grammar in BNF or EBNF form), that defines a syntax of a programming language. Tiger grammar with Menhir Link to heading While reading the current paragraph I highly recommend consulting the Tiger Language Reference Manual that has a precise description (along with a BNF notation) of everything we’re going to define below.">

<meta property="og:url" content="https://vyorkin.org/posts/making-of-tiger-3-parsing/">
  <meta property="og:site_name" content="vyorkin.org">
  <meta property="og:title" content="Making of Tiger #3, Parsing">
  <meta property="og:description" content="Intro Link to heading In this chapter we’re going to build a parser for our Tiger language. First, let’s do a quick recap of some important concepts of the theory behind programming language parsers:
Parser generator is the most common type of compiler-compiler’s. It takes some formal grammar (typically it is a context-free grammar in BNF or EBNF form), that defines a syntax of a programming language. Tiger grammar with Menhir Link to heading While reading the current paragraph I highly recommend consulting the Tiger Language Reference Manual that has a precise description (along with a BNF notation) of everything we’re going to define below.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-09-08T15:58:00+03:00">
    <meta property="article:modified_time" content="2019-09-08T15:58:00+03:00">
    <meta property="article:tag" content="Compilers">
    <meta property="article:tag" content="Tiger">
    <meta property="article:tag" content="Ocaml">
    <meta property="article:tag" content="Parsing">
    <meta property="article:tag" content="Menhir">




<link rel="canonical" href="https://vyorkin.org/posts/making-of-tiger-3-parsing/">


<link rel="preload" href="https://vyorkin.org/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://vyorkin.org/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://vyorkin.org/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="https://vyorkin.org/css/coder.min.07092c1350ffd254998dc43a44ae96e617d14af4df4602626878df89189c5e1a.css" integrity="sha256-BwksE1D/0lSZjcQ6RK6W5hfRSvTfRgJiaHjfiRicXho=" crossorigin="anonymous" media="screen" />





  
    
    
    <link rel="stylesheet" href="https://vyorkin.org/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  




  
  <link rel="stylesheet" href="https://vyorkin.org/custom.min.37b90b4ab2011637071ddd3590a64f81899b71c028d2d366c001566e70ee9e90.css" integrity="sha256-N7kLSrIBFjcHHd01kKZPgYmbccAo0tNmwAFWbnDunpA=" crossorigin="anonymous" media="screen" />


<link rel="icon" type="image/svg+xml" href="https://vyorkin.org/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="https://vyorkin.org/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://vyorkin.org/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="https://vyorkin.org/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://vyorkin.org/images/apple-touch-icon.png">

<link rel="manifest" href="https://vyorkin.org/site.webmanifest">
<link rel="mask-icon" href="https://vyorkin.org/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://vyorkin.org/">
      vyorkin.org
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://vyorkin.org/about/">about</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://vyorkin.org/posts/">posts</a>
            </li>
          
        
        
          
          
          
            
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://vyorkin.org/ru-ru/">ru</a>
              </li>
            
          
            
              
              <li class="navigation-item">
                <a href="https://vyorkin.org/de-de/">de</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://vyorkin.org/posts/making-of-tiger-3-parsing/">
              Making of Tiger #3, Parsing
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="September 8, 2019">
                September 8, 2019
              </time>
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="https://vyorkin.org/tags/compilers/">Compilers</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://vyorkin.org/tags/tiger/">Tiger</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://vyorkin.org/tags/ocaml/">Ocaml</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://vyorkin.org/tags/parsing/">Parsing</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://vyorkin.org/tags/menhir/">Menhir</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="intro">
  Intro
  <a class="heading-link" href="#intro">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this chapter we’re going to build a parser for our Tiger
language. First, let’s do a quick recap of some important
concepts of the theory behind programming language parsers:</p>
<ul>
<li><strong>Parser generator</strong> is the most common type of
<a href="https://en.wikipedia.org/wiki/Compiler-compiler"  class="external-link" target="_blank" rel="noopener">compiler-compiler’s</a>. It takes some formal grammar (typically
it is a <a href="https://en.wikipedia.org/wiki/Context-free_grammar"  class="external-link" target="_blank" rel="noopener">context-free grammar</a> in <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form"  class="external-link" target="_blank" rel="noopener">BNF</a> or <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form"  class="external-link" target="_blank" rel="noopener">EBNF </a>form), that
defines a syntax of a programming language.</li>
</ul>
<h2 id="tiger-grammar-with-menhir">
  Tiger grammar with Menhir
  <a class="heading-link" href="#tiger-grammar-with-menhir">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>While reading the current paragraph I highly recommend
consulting the <strong>Tiger Language Reference Manual</strong> that has a
precise description (along with a BNF notation) of everything
we’re going to define below.</p>
<p><a href="http://gallium.inria.fr/~fpottier/menhir/"  class="external-link" target="_blank" rel="noopener">Menhir</a> is an LR(1) parser generator library for OCaml. It
<a href="https://dune.readthedocs.io/en/stable/dune-files.html#menhir"  class="external-link" target="_blank" rel="noopener">integrates with Dune</a> quiet nicely. All we need to do is to add
the <code>menhir</code> stanza to our <code>dune</code> file (the one from the
previous chapter). So the whole file will look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span>(<span style="color:#434f54">menhir</span>
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">modules</span> <span style="color:#434f54">parser</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">flags</span> (<span style="color:#7f8c8d">&#34;--dump&#34;</span> <span style="color:#7f8c8d">&#34;--explain&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#434f54">ocamllex</span>
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">modules</span> <span style="color:#434f54">lexer</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#434f54">library</span>
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">name</span> <span style="color:#434f54">ch3</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">inline_tests</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">libraries</span> <span style="color:#434f54">core</span> <span style="color:#434f54">stdio</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">preprocess</span> (<span style="color:#434f54">pps</span> <span style="color:#434f54">ppx_inline_test</span> <span style="color:#434f54">ppx_expect</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#434f54">env</span> (<span style="color:#434f54">dev</span> (<span style="color:#434f54">flags</span> (<span style="color:#7f8c8d">:standard</span> <span style="color:#434f54">-warn-error</span> <span style="color:#434f54">-A</span>))))
</span></span></code></pre></div><p>Notice the <code>--dump</code> and <code>--explain</code> switches:</p>
<ul>
<li>The <code>--dump</code> switch means to write a description of the
automaton to the <code>.automaton</code> file.</li>
<li>The <code>--explain</code> switch helps us to understand severe conflicts in
terms of a grammar (rather than in terms of automaton),
enabling it means to write a textual explanation of detected
shift-reduce conflicts to the <code>.conflicts</code> file. <a href="http://ix.io/1SAS"  class="external-link" target="_blank" rel="noopener">Here is
the example</a> of how it looks.</li>
</ul>
<p>See the <a href="http://gallium.inria.fr/~fpottier/menhir/manual.html#sec37"  class="external-link" target="_blank" rel="noopener">conflicts</a> part of the Menhir manual for details.</p>
<p>We’ll use the
<a href="http://gallium.inria.fr/~fpottier/menhir/manual.html#sec23"  class="external-link" target="_blank" rel="noopener">new
syntax</a> for rules (despite the fact that it is considered
experimental). First, let’s define some
<a href="http://gallium.inria.fr/~fpottier/menhir/manual.html#sec9"  class="external-link" target="_blank" rel="noopener">token
aliases</a>, priorities and associativity levels. Basically these
are the same tokens we used in our lexer.</p>
<p>Base keywords:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">TYPE</span>     <span style="color:#7f8c8d">&#34;type&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">VAR</span>      <span style="color:#7f8c8d">&#34;var&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">FUNCTION</span> <span style="color:#7f8c8d">&#34;function&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">BREAK</span>    <span style="color:#7f8c8d">&#34;break&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">OF</span>       <span style="color:#7f8c8d">&#34;of&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">END</span>      <span style="color:#7f8c8d">&#34;end&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">IN</span>       <span style="color:#7f8c8d">&#34;in&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">NIL</span>      <span style="color:#7f8c8d">&#34;nil&#34;</span> <span style="color:#95a5a6">(* nil denotes a value belonging to every record type *)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LET</span>      <span style="color:#7f8c8d">&#34;let&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">ARRAY</span>    <span style="color:#7f8c8d">&#34;array&#34;</span>
</span></span></code></pre></div><p>Loop-related keywords:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">DO</span>    <span style="color:#7f8c8d">&#34;do&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">TO</span>    <span style="color:#7f8c8d">&#34;to&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">FOR</span>   <span style="color:#7f8c8d">&#34;for&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">WHILE</span> <span style="color:#7f8c8d">&#34;while&#34;</span>
</span></span></code></pre></div><p>Keywords for conditional expression:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">IF</span>   <span style="color:#7f8c8d">&#34;if&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">THEN</span> <span style="color:#7f8c8d">&#34;then&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">ELSE</span> <span style="color:#7f8c8d">&#34;else&#34;</span>
</span></span></code></pre></div><p>Operator tokens:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#95a5a6">(* General *)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">ASSIGN</span> <span style="color:#7f8c8d">&#34;:=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6">(* Logical *)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">OR</span>  <span style="color:#7f8c8d">&#34;|&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">AND</span> <span style="color:#7f8c8d">&#34;&amp;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6">(* Comparison *)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">GE</span>  <span style="color:#7f8c8d">&#34;&gt;=&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">GT</span>  <span style="color:#7f8c8d">&#34;&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LE</span>  <span style="color:#7f8c8d">&#34;&lt;=&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LT</span>  <span style="color:#7f8c8d">&#34;&lt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">NEQ</span> <span style="color:#7f8c8d">&#34;&lt;&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">EQ</span>  <span style="color:#7f8c8d">&#34;=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6">(* Arithmetics *)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">DIVIDE</span> <span style="color:#7f8c8d">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">TIMES</span>  <span style="color:#7f8c8d">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">PLUS</span>   <span style="color:#7f8c8d">&#34;+&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">MINUS</span>  <span style="color:#7f8c8d">&#34;-&#34;</span>
</span></span></code></pre></div><p>Tokens for separators:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">DOT</span>       <span style="color:#7f8c8d">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LBRACE</span>    <span style="color:#7f8c8d">&#34;{&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">RBRACE</span>    <span style="color:#7f8c8d">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LBRACK</span>    <span style="color:#7f8c8d">&#34;[&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">RBRACK</span>    <span style="color:#7f8c8d">&#34;]&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">LPAREN</span>    <span style="color:#7f8c8d">&#34;(&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">RPAREN</span>    <span style="color:#7f8c8d">&#34;)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">SEMICOLON</span> <span style="color:#7f8c8d">&#34;;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">COLON</span>     <span style="color:#7f8c8d">&#34;:&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">COMMA</span>     <span style="color:#7f8c8d">&#34;,&#34;</span>
</span></span></code></pre></div><p>Strings, numbers, identifiers and the <code>EOF</code> token:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#728e00">&lt;</span><span style="color:#00979d">string</span><span style="color:#728e00">&gt;</span> <span style="color:#434f54">STRING</span> <span style="color:#7f8c8d">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#728e00">&lt;</span><span style="color:#00979d">int</span><span style="color:#728e00">&gt;</span>    <span style="color:#434f54">INT</span>    <span style="color:#7f8c8d">&#34;int&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#728e00">&lt;</span><span style="color:#00979d">string</span><span style="color:#728e00">&gt;</span> <span style="color:#434f54">ID</span>     <span style="color:#7f8c8d">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">token</span> <span style="color:#434f54">EOF</span>
</span></span></code></pre></div><p>Associativity of operators:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;of&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;then&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;else&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;do&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;:=&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">left</span>     <span style="color:#7f8c8d">&#34;|&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">left</span>     <span style="color:#7f8c8d">&#34;&amp;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">nonassoc</span> <span style="color:#7f8c8d">&#34;&gt;=&#34;</span> <span style="color:#7f8c8d">&#34;&gt;&#34;</span> <span style="color:#7f8c8d">&#34;&lt;=&#34;</span> <span style="color:#7f8c8d">&#34;&lt;&#34;</span> <span style="color:#7f8c8d">&#34;&lt;&gt;&#34;</span> <span style="color:#7f8c8d">&#34;=&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">left</span>     <span style="color:#7f8c8d">&#34;+&#34;</span> <span style="color:#7f8c8d">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">left</span>     <span style="color:#7f8c8d">&#34;*&#34;</span> <span style="color:#7f8c8d">&#34;/&#34;</span>
</span></span></code></pre></div><p>The grammar rules:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">%</span><span style="color:#434f54">start</span> <span style="color:#728e00">&lt;</span><span style="color:#00979d">unit</span><span style="color:#728e00">&gt;</span> <span style="color:#434f54">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">%%</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">main</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">~</span> <span style="color:#728e00">=</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#434f54">EOF</span><span style="color:#728e00">;</span> <span style="color:#728e00">&lt;&gt;</span>
</span></span></code></pre></div><p>Top-level expression:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">expr</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">primitive</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;nil&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;break&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">create_rec</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">create_arr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">lvalue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">assignment</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">conditional</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">loop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">fun_call</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">unary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">binary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">seq</span>
</span></span></code></pre></div><p>It might not be obvious from the <code>expr</code> definition, but it also
includes a thing called <code>no value</code> (an expression that yields no
value). So when looking at the top-level expression and
comparing it to the language reference manual, please note that
in our grammar <code>no_val := &quot;(&quot; &quot;)&quot;</code> (empty <code>seq</code>).</p>
<p>There are two built-in (predefined) primitive types: <code>int</code> and
<code>string</code>. The grammar rule for those is pretty straightforward:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">primitive</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;string&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;int&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span></code></pre></div><p>In our language we have only one unary operator – minus:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">unary</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;-&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>But we have two kinds of binary operators: <code>boolean</code> and
“logical + arithmetic”, which we’ll simply call <code>bin</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">binary</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">bin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">boolean</span>
</span></span></code></pre></div><p>Scroll down to see the definitions of <code>bin</code> and <code>boolean</code>.</p>
<p>We have 2 kinds of loops: the <code>while</code> loop and the <code>for</code> loop:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">loop</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">while_loop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">for_loop</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">while_loop</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;while&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;do&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">for_loop</span>   <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;for&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;:=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;to&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;do&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>Nothing new or unusual. And the conditional expression rule is
also quite trivial:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">conditional</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;if&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;then&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;else&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;if&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;then&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>Syntax for local bindings is going to be exactly like in OCaml
or SML:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">local</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;let&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">decs</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;in&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr_seq</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;end&#34;</span>
</span></span></code></pre></div><p>Now, a slightly more complex part – declarations.</p>
<p>As stated in the Tiger language reference manual, a
declaration-sequence is a sequence of <strong>type</strong>, <strong>value</strong>, and
<strong>function declarations</strong>. No punctuation separates or terminates
individual declarations.</p>
<p>In terms of Menhir we can express it like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">decs</span> <span style="color:#728e00">:=</span> <span style="color:#00979d">list</span><span style="color:#728e00">(</span><span style="color:#434f54">dec</span><span style="color:#728e00">);</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">dec</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">ty_dec</span>  <span style="color:#95a5a6">(* type *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">var_dec</span> <span style="color:#95a5a6">(* value *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">fun_dec</span> <span style="color:#95a5a6">(* function declaration *)</span>
</span></span></code></pre></div><p>Ok, we need to define a separate rule for each declaration
mentioned above.</p>
<p>To declare a data type in the Tiger language we start with the
keyword <code>type</code>, after which comes the identifier, the equality
token and the type declaration body:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">ty_dec</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;type&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">ty</span>
</span></span></code></pre></div><p>The type declaration could be a <strong>record</strong>, an <strong>array</strong> or a <strong>type
alias</strong> (any identifier):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">ty</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">braced</span><span style="color:#728e00">(</span><span style="color:#434f54">ty_fields</span><span style="color:#728e00">)</span> <span style="color:#95a5a6">(* records *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;array&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;of&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span> <span style="color:#95a5a6">(* arrays *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">ty_fields</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">separated_list</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;,&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">ty_field</span><span style="color:#728e00">);</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">ty_field</span>  <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">ty_ann</span>
</span></span></code></pre></div><p>As per language reference manual, there are two possible ways to
declare a variable: with or without type annotation. The
following rule reflects this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">var_dec</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;var&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span>         <span style="color:#7f8c8d">&#34;:=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;var&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">ty_ann</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;:=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>The record and array creation rules below are also considered
top-level expressions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">create_rec</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">braced</span><span style="color:#728e00">(</span><span style="color:#434f54">init_rec_fields</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">create_arr</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">bracketed</span><span style="color:#728e00">(</span><span style="color:#434f54">expr</span><span style="color:#728e00">);</span> <span style="color:#7f8c8d">&#34;of&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">init_rec_fields</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">separated_list</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;,&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">init_rec_field</span><span style="color:#728e00">);</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">init_rec_field</span>  <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>Next, we need a function declaration rule:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_dec</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* procedures doesn&#39;t return values *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">fun_head</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">fun_body</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* functions return values and the type is specified after the colon *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">fun_head</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;:&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">fun_body</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_head</span>   <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;function&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">fun_params</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_body</span>   <span style="color:#728e00">:=</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_params</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">parenthesized</span><span style="color:#728e00">(</span><span style="color:#434f54">ty_fields</span><span style="color:#728e00">)</span>
</span></span></code></pre></div><p>According to our language spec:</p>
<p>&gt; An <code>l-value</code> is a location, whose value may be read or assigned.
&gt; Variables, procedure parameters, fields or records, and
elements are all <code>l-values</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">lvalue</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* variable *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* everything else *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">lvalue_t</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">lvalue_t</span> <span style="color:#728e00">:=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* simple record field *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;.&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* compound record field *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">lvalue_t</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;.&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* simple array subscript *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">bracketed</span><span style="color:#728e00">(</span><span style="color:#434f54">expr</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#95a5a6">(* compund array subscript *)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">lvalue_t</span><span style="color:#728e00">;</span> <span style="color:#434f54">bracketed</span><span style="color:#728e00">(</span><span style="color:#434f54">expr</span><span style="color:#728e00">)</span>
</span></span></code></pre></div><p>Assignment of an expression to <code>lvalue</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">assignment</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">lvalue</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;:=&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span></code></pre></div><p>Sequence of expressions delimited by semicolon:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">expr_seq</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">separated_list</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;;&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">expr</span><span style="color:#728e00">);</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">seq</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">parenthesized</span><span style="color:#728e00">(</span><span style="color:#434f54">expr_seq</span><span style="color:#728e00">)</span>
</span></span></code></pre></div><p>Function call rule:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_call</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;id&#34;</span><span style="color:#728e00">;</span> <span style="color:#434f54">parenthesized</span><span style="color:#728e00">(</span><span style="color:#434f54">fun_args</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">fun_args</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">separated_list</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;,&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">expr</span><span style="color:#728e00">);</span> <span style="color:#728e00">{</span> <span style="color:#434f54">()</span> <span style="color:#728e00">}</span>
</span></span></code></pre></div><p>Arithmetic, comparison and equality expressions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">bin</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#434f54">bin_op</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">bin_op</span> <span style="color:#728e00">==</span> <span style="color:#7f8c8d">&#34;+&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;-&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;*&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;/&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;&gt;=&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;&gt;&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;&lt;=&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;&lt;&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;&lt;&gt;&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;=&#34;</span>
</span></span></code></pre></div><p>Boolean expressions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">boolean</span> <span style="color:#728e00">:=</span> <span style="color:#434f54">expr</span><span style="color:#728e00">;</span> <span style="color:#434f54">boolean_op</span><span style="color:#728e00">;</span> <span style="color:#434f54">expr</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">boolean_op</span> <span style="color:#728e00">==</span> <span style="color:#7f8c8d">&#34;&amp;&#34;</span> <span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;|&#34;</span>
</span></span></code></pre></div><p>Helper rule for a type annotation which we used in the <code>var_dec</code>
and <code>ty_field</code> above:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">ty_ann</span> <span style="color:#728e00">:=</span> <span style="color:#7f8c8d">&#34;:&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;id&#34;</span>
</span></span></code></pre></div><p>Menhir allows us to declare functions, so these are three helper
functions that we used everywhere else for delimited
expressions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">parenthesized</span><span style="color:#728e00">(</span><span style="color:#434f54">x</span><span style="color:#728e00">)</span> <span style="color:#728e00">==</span> <span style="color:#434f54">delimited</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;(&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">x</span><span style="color:#728e00">,</span> <span style="color:#7f8c8d">&#34;)&#34;</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">bracketed</span><span style="color:#728e00">(</span><span style="color:#434f54">x</span><span style="color:#728e00">)</span>     <span style="color:#728e00">==</span> <span style="color:#434f54">delimited</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;[&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">x</span><span style="color:#728e00">,</span> <span style="color:#7f8c8d">&#34;]&#34;</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">braced</span><span style="color:#728e00">(</span><span style="color:#434f54">x</span><span style="color:#728e00">)</span>        <span style="color:#728e00">==</span> <span style="color:#434f54">delimited</span><span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;{&#34;</span><span style="color:#728e00">,</span> <span style="color:#434f54">x</span><span style="color:#728e00">,</span> <span style="color:#7f8c8d">&#34;}&#34;</span><span style="color:#728e00">)</span>
</span></span></code></pre></div><h2 id="test-suite">
  Test suite
  <a class="heading-link" href="#test-suite">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In order to iterate on our parser quickly we want to automate
the process of testing it against the <a href="https://github.com/vyorkin/tiger/blob/master/book/testcases/test1.tig"  class="external-link" target="_blank" rel="noopener">provided example programs</a>.
The most convenient way to do that would be to create a test
suite that we could run after every change we make.</p>
<p>Some of the provided example Tiger programs are intentionally
broken, so we want to skip those:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">skipped</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">[</span><span style="color:#7f8c8d">&#34;test16.tig&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;test17.tig&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;test19.tig&#34;</span><span style="color:#728e00">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#7f8c8d">&#34;test20.tig&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;test25.tig&#34;</span><span style="color:#728e00">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#7f8c8d">&#34;test45.tig&#34;</span><span style="color:#728e00">;</span> <span style="color:#7f8c8d">&#34;test49.tig&#34;</span><span style="color:#728e00">]</span>
</span></span></code></pre></div><p>A couple of helper functions to list the example programs
(recursively):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">is_tig_ext</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#728e00">(_,</span> <span style="color:#434f54">ext</span><span style="color:#728e00">)</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Filename</span>.<span style="color:#434f54">split_extension</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">match</span> <span style="color:#434f54">ext</span> <span style="color:#728e00">with</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">Some</span> <span style="color:#7f8c8d">&#34;tig&#34;</span> <span style="color:#728e00">-&gt;</span> <span style="color:#434f54">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#728e00">_</span> <span style="color:#728e00">-&gt;</span> <span style="color:#434f54">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">is_tig_file</span> <span style="color:#434f54">f</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Sys</span>.<span style="color:#434f54">is_file_exn</span> <span style="color:#728e00">~</span><span style="color:#434f54">follow_symlinks</span><span style="color:#728e00">:</span><span style="color:#434f54">true</span> <span style="color:#434f54">f</span> <span style="color:#728e00">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">is_tig_ext</span> <span style="color:#434f54">f</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#728e00">rec</span> <span style="color:#434f54">ls_rec</span> <span style="color:#434f54">dir</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">if</span> <span style="color:#434f54">is_tig_file</span> <span style="color:#434f54">dir</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">if</span> <span style="color:#434f54">not</span><span style="color:#728e00">(</span><span style="color:#434f54">List</span>.<span style="color:#434f54">mem</span> <span style="color:#434f54">skipped</span> <span style="color:#728e00">(</span><span style="color:#434f54">Filename</span>.<span style="color:#434f54">basename</span> <span style="color:#434f54">dir</span><span style="color:#728e00">)</span> <span style="color:#728e00">~</span><span style="color:#434f54">equal</span><span style="color:#728e00">:(=))</span> <span style="color:#728e00">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#728e00">[</span><span style="color:#434f54">dir</span><span style="color:#728e00">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#434f54">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">dir</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">|&gt;</span> <span style="color:#434f54">Sys</span>.<span style="color:#434f54">ls_dir</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">|&gt;</span> <span style="color:#434f54">List</span>.<span style="color:#434f54">concat_map</span>
</span></span><span style="display:flex;"><span>      <span style="color:#728e00">~</span><span style="color:#434f54">f</span><span style="color:#728e00">:(</span><span style="color:#728e00">fun</span> <span style="color:#434f54">sub</span> <span style="color:#728e00">-&gt;</span> <span style="color:#434f54">ls_rec</span> <span style="color:#728e00">(</span><span style="color:#434f54">Filename</span>.<span style="color:#434f54">concat</span> <span style="color:#434f54">dir</span> <span style="color:#434f54">sub</span><span style="color:#728e00">))</span>
</span></span></code></pre></div><p>Let’s add another helper function to get current position along
with a filename as a string. We’ll need it later to output an
error location:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">position</span> <span style="color:#434f54">lexbuf</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">pos</span> <span style="color:#728e00">=</span> <span style="color:#434f54">lexbuf</span><span style="color:#728e00">.</span><span style="color:#434f54">lex_curr_p</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">col</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pos</span><span style="color:#728e00">.</span><span style="color:#434f54">pos_cnum</span> <span style="color:#728e00">-</span> <span style="color:#434f54">pos</span><span style="color:#728e00">.</span><span style="color:#434f54">pos_bol</span> <span style="color:#728e00">+</span> <span style="color:#434f54">1</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Printf</span>.<span style="color:#434f54">sprintf</span> <span style="color:#7f8c8d">&#34;%s:%d:%d&#34;</span> <span style="color:#434f54">pos</span><span style="color:#728e00">.</span><span style="color:#434f54">pos_fname</span> <span style="color:#434f54">pos</span><span style="color:#728e00">.</span><span style="color:#434f54">pos_lnum</span> <span style="color:#434f54">col</span>
</span></span></code></pre></div><p>And another two functions to run the parser and print the error
details in case of failure:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">parse_with_error</span> <span style="color:#434f54">lexbuf</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">try</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">Parser</span>.<span style="color:#434f54">main</span> <span style="color:#434f54">Lexer</span>.<span style="color:#434f54">read</span> <span style="color:#434f54">lexbuf</span><span style="color:#728e00">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">assert_bool</span> <span style="color:#7f8c8d">&#34;Ok&#34;</span> <span style="color:#434f54">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">with</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">SyntaxError</span> <span style="color:#434f54">msg</span> <span style="color:#728e00">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">assert_failure</span> <span style="color:#728e00">(</span><span style="color:#434f54">position</span> <span style="color:#434f54">lexbuf</span> <span style="color:#728e00">^</span> <span style="color:#7f8c8d">&#34; : &#34;</span> <span style="color:#728e00">^</span> <span style="color:#434f54">msg</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">|</span> <span style="color:#434f54">Parser</span>.<span style="color:#434f54">Error</span> <span style="color:#728e00">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">assert_failure</span> <span style="color:#728e00">(</span><span style="color:#7f8c8d">&#34;Syntax error: &#34;</span> <span style="color:#728e00">^</span> <span style="color:#434f54">position</span> <span style="color:#434f54">lexbuf</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">parse</span> <span style="color:#434f54">filename</span> <span style="color:#434f54">ch</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">lexbuf</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Lexing</span>.<span style="color:#434f54">from_channel</span> <span style="color:#434f54">ch</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">lexbuf</span><span style="color:#728e00">.</span><span style="color:#434f54">lex_curr_p</span> <span style="color:#728e00">&lt;-</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">lexbuf</span><span style="color:#728e00">.</span><span style="color:#434f54">lex_curr_p</span> <span style="color:#728e00">with</span> <span style="color:#434f54">pos_fname</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Filename</span>.<span style="color:#434f54">basename</span> <span style="color:#434f54">filename</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">};</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">parse_with_error</span> <span style="color:#434f54">lexbuf</span>
</span></span></code></pre></div><p>Here is the function that we’re going to call for each <code>.tig</code>
file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">run_parser</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">_</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">In_channel</span>.<span style="color:#434f54">with_file</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">~</span><span style="color:#434f54">f</span><span style="color:#728e00">:(</span><span style="color:#434f54">parse</span> <span style="color:#434f54">filename</span><span style="color:#728e00">)</span>
</span></span></code></pre></div><p>Finally, the test suite is going to look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">suite</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#7f8c8d">&#34;tiger programs&#34;</span> <span style="color:#728e00">&gt;:::</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">tests_dir</span> <span style="color:#728e00">=</span> <span style="color:#7f8c8d">&#34;../../../book&#34;</span> <span style="color:#728e00">^</span> <span style="color:#434f54">Filename</span>.<span style="color:#434f54">dir_sep</span> <span style="color:#728e00">^</span> <span style="color:#7f8c8d">&#34;testcases&#34;</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">tests_path</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Filename</span>.<span style="color:#728e00">(</span><span style="color:#434f54">concat</span> <span style="color:#434f54">parent_dir_name</span> <span style="color:#434f54">tests_dir</span><span style="color:#728e00">)</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">let</span> <span style="color:#434f54">tig_files</span> <span style="color:#728e00">=</span> <span style="color:#434f54">ls_rec</span> <span style="color:#434f54">tests_path</span> <span style="color:#728e00">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#728e00">(</span><span style="color:#434f54">List</span>.<span style="color:#434f54">map</span> <span style="color:#728e00">~</span><span style="color:#434f54">f</span><span style="color:#728e00">:</span>
</span></span><span style="display:flex;"><span>     <span style="color:#728e00">(</span><span style="color:#728e00">fun</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">-&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">Filename</span>.<span style="color:#434f54">basename</span> <span style="color:#434f54">filename</span> <span style="color:#728e00">&gt;::</span> <span style="color:#434f54">run_parser</span> <span style="color:#434f54">filename</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#434f54">tig_files</span><span style="color:#728e00">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">let</span> <span style="color:#434f54">()</span> <span style="color:#728e00">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">run_test_tt_main</span> <span style="color:#434f54">suite</span>
</span></span></code></pre></div><p>The dune file for our test suite project will simply run the
<code>testsuite.exe</code> executable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span>(<span style="color:#434f54">executable</span>
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">name</span> <span style="color:#434f54">testsuite</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">libraries</span> <span style="color:#434f54">base</span> <span style="color:#434f54">core</span> <span style="color:#434f54">ch3</span> <span style="color:#434f54">oUnit</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#434f54">alias</span>
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">name</span> <span style="color:#434f54">runtest</span>)
</span></span><span style="display:flex;"><span> (<span style="color:#434f54">action</span> (<span style="color:#434f54">run</span> <span style="color:#728e00">.</span><span style="color:#434f54">/testsuite.exe</span>)))
</span></span></code></pre></div><p>Now it’ll be much easier to work on the parser implementation.
Also this test suite might be useful to detect possible
regressions if we want to change the parser in the future.</p>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Of course, I didn’t come up with this grammar right away. I
spent almost a week implementing this parser. I started with a
simple parser for “straightline programs” and iterated on it
until it evolved to the fully functional Tiger-language grammar.
And it took some time for me to figure out how to resolve all
the shift-reduce conflicts.</p>
<p>Another cool feature of Menhir is its REPL, which might be
helpful for debugging. This is especially useful when you
already caught a parser error by running the test suite and now
you want to try constructing an invalid expression to check your
hypothesis. I used this kind of workflow a lot while working on
this grammar.</p>
<p>You can run the interpreter like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>menhir --interpret --interpret-show-cst parser.mly
</span></span></code></pre></div><p>Now you can start typing expressions until you find something
that breaks your parser. Note that you can’t use token aliases
inside this REPL.</p>
<p>For example, here is how you can test a function declaration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#434f54">LET</span> <span style="color:#434f54">FUNCTION</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">LPAREN</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">COLON</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">RPAREN</span> <span style="color:#434f54">COLON</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">EQ</span> <span style="color:#434f54">IF</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">EQ</span> <span style="color:#434f54">INT</span> <span style="color:#434f54">THEN</span> <span style="color:#434f54">INT</span> <span style="color:#434f54">ELSE</span> <span style="color:#434f54">INT</span> <span style="color:#434f54">TIMES</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">LPAREN</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">MINUS</span> <span style="color:#434f54">INT</span> <span style="color:#434f54">RPAREN</span> <span style="color:#434f54">IN</span> <span style="color:#434f54">ID</span> <span style="color:#434f54">LPAREN</span> <span style="color:#434f54">INT</span> <span style="color:#434f54">RPAREN</span> <span style="color:#434f54">END</span>
</span></span></code></pre></div><p>That’s it for now. The full source code for this chapter
<a href="https://github.com/vyorkin/tiger/blob/master/chapter3/lib/parser.mly"  class="external-link" target="_blank" rel="noopener">is
here</a>. Next time we’re going to work on the AST for our Tiger
language.</p>

        
      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      1985 -
    
    2024
     Vasiliy Yorkin 
    
  </section>
</footer>

  </main>

  

  
  
  <script src="https://vyorkin.org/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-F8R77TYF8B"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-F8R77TYF8B');
        }
      </script>
    
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
